

plugins {
	id 'org.asciidoctor.convert' version '1.5.6' apply false
}

// Let's get the group and version for this project
apply from: 'common_conf.gradle'


allprojects {
	


/*
	Apparently, constraint doesn't with maven dependencies!
	
	Gradle IS REALLY A MESS!
	:(
	
	dependencies {
	    constraints {
			// Internal plugin dependencies
		    implementation("com.graphql-java-generator:graphql-java-client-dependencies:${project.version}")
		    implementation("com.graphql-java-generator:graphql-java-server-dependencies:${project.version}")
		    
		    // GraphQL dependencies
		    implementation 'com.graphql-java:graphql-java-extended-scalars:1.0.1'
		
			// Dependencies for tests
			testImplementation 'org.springframework:spring-test:5.2.5.RELEASE'
			testImplementation 'org.junit.jupiter:junit-jupiter-api:5.5.0'
			testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.5.0'
			testRuntimeOnly 'org.apache.logging.log4j:log4j-slf4j-impl:2.11.2'
	    }
	}
*/

}


subprojects {
	
	// Let's get the group and version for this project
	apply from: '../common_conf.gradle'
	
	// Dependency management
	ext {
		graphqlJavaExtendedScalarsVersion = '1.0.1'
		springTestVersion = '5.2.5.RELEASE'
		junitJupiterVersion = '5.5.0'
		log4jVersion = '2.11.2'		
	}
	
	if (project.name.contains('samples') && System.properties['graphqlGradlePlugin.graphqlMavenPluginProject.path'] != null) {

		task copySamplesFromMavenPlugin(type: Copy) {
			group = "Preparation"
			description = "Copy the sources from the GraphQL maven plugin to the Gradle plugin"

			doLast {
				println "copy from: " + System.properties['graphqlGradlePlugin.graphqlMavenPluginProject.path'] +'/graphql-maven-plugin-samples/' + project.name.replace('gradle', 'maven')
				println "copy into: ${project.projectDir}"
			}
							
			// Please set the systemProp.graphqlGradlePlugin.graphqlMavenPluginProject.path in the gradle.properties to the
			// full path for the graphql-maven-plugin-project folder
			// OR IGNORE IF YOU JUST BUILD THE GRADLE PLUGIN as a standalone
			// 
			// Let's the source files from the graphql-maven-plugin-samples-XXX folder into the current project
		    from(System.properties['graphqlGradlePlugin.graphqlMavenPluginProject.path'] +'/graphql-maven-plugin-samples/' + project.name.replace('gradle', 'maven')) {
		    	include "/src/main/**"
		    	include "/src/test/**"
		    }
		    into "${project.projectDir}"
		}
	}
}

